
#include <stdio.h>
#include <comedilib.h>
#include <fcntl.h>
#include <unistd.h>
#include <sys/ioctl.h>
#include <errno.h>
#include <math.h>


/*
	Chromel-Alumel thermocouple emf, in millivolts, for temperatures
	-190+10*i, in deg. C
*/

double thermoc_data[]={
	-5.60, -5.43, -5.24, -5.03, -4.81, -4.58, -4.32, -4.06, -3.78,
	-3.49, -3.19, -2.87, -2.54, -2.29, -1.86, -1.50, -1.14, -0.77,
	-0.39, 0.00, 0.40, 0.80, 1.20, 1.61, 2.02, 2.43, 2.85, 3.26,
	3.68, 4.10, 4.51, 4.92, 5.33, 5.73, 6.13, 6.53, 6.93, 7.33,
	7.73, 8.13, 8.54, 8.94, 9.34, 9.75, 10.16, 10.57, 10.98,
	11.39, 11.80, 12.21, 12.63, 13.04, 13.46, 13.88, 14.29, 14.71,
	15.13, 15.55, 15.98, 16.40, 16.82, 17.24, 17.67, 18.09, 18.51,
	18.94, 19.36, 19.79, 20.22, 20.65, 21.07, 21.50, 21.92, 22.35,
	22.78, 23.20, 23.63, 24.06, 24.49, 24.91, 25.34, 25.76, 26.19,
	26.61, 27.03, 27.45, 27.87, 28.29, 28.72, 29.14, 29.56, 29.97,
	30.39, 30.81, 31.23, 31.65, 32.06, 32.48, 32.89, 33.30, 33.71,
	34.12, 34.53, 34.93, 35.34, 35.75, 36.15, 36.55, 36.96, 37.36,
	37.76, 38.16, 38.56, 38.95, 39.35, 39.75, 40.14, 40.53, 40.92,
	41.31, 41.70, 42.09, 42.48, 42.87, 43.25, 43.63, 44.02, 44.40,
	44.78, 45.16, 45.54, 45.92, 46.29, 46.67, 47.04, 47.41, 47.78,
	48.15, 48.52, 48.89, 49.25, 49.62, 49.98, 50.34, 50.69, 51.05,
	51.41, 51.76, 52.11, 52.46, 52.81, 53.16, 53.51, 53.85, 54.20,
	54.54, 54.88
};

#define N_PTS 157


double thermoc_temp(double emf)
{
	int i;
	double temp;
	
	if(emf<thermoc_data[0] || emf>thermoc_data[N_PTS-1])
		return NAN;
	
	for(i=0;i<N_PTS-1;i++)
		if(emf<thermoc_data[i])break;
	
	i--;
	temp=-190.0+10.0*i;
	temp+=10.0*(emf-thermoc_data[i])/(thermoc_data[i+1]-thermoc_data[i]);
	
	return temp;
}

double thermoc_emf(double temp)
{
	double emf,x;
	int i;
	
	if(temp<-190.0 || temp>=-190.0+10.0*N_PTS)return NAN;
	
	x=(temp+190.0)/10.0;
	i=floor(x);
	x-=i;
	emf=thermoc_data[i]*(1-x)+x*thermoc_data[i+1];

	return emf;
}

